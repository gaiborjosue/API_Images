<!DOCTYPE html>
<html lang="en">
  <head>
    <title>VTK.js MRI Visualization</title>

    <script type="text/javascript" src="https://unpkg.com/@babel/polyfill/dist/polyfill.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vtk.js@29.4.5/vtk.js"></script>
    
  </head>
  <body>
    <div id="vtk-renderer" style="height: 800px; padding: 0px;"></div>

    <script type="text/javascript">

      const fullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({ container: document.querySelector('#vtk-renderer'), background: [0.,0.,0.]});

      const renderer = fullScreenRenderWindow.getRenderer();

      const renderWindow = fullScreenRenderWindow.getRenderWindow();

      // Load VTI file
      const reader = vtk.IO.XML.vtkXMLImageDataReader.newInstance();

      const actor = vtk.Rendering.Core.vtkVolume.newInstance();
      const mapper = vtk.Rendering.Core.vtkVolumeMapper.newInstance();

      reader
        .setUrl(
          "https://raw.githubusercontent.com/gaiborjosue/API_Images/main/data/daniel.vti", { loadData: true }
        )
        .then(function () {
          var imageData = reader.getOutputData();

          actor.setMapper(mapper);

          mapper.setInputData(imageData);

          renderer.addVolume(actor);
          renderer.resetCamera();
          renderWindow.render();

          console.log('ready...');

          const dataArray = imageData.getPointData().getScalars();

          const pixelData = dataArray.getData();

          console.log("Volume Dimensions: ", imageData.getDimensions());
          // All
          console.log("Full Volume (flattened): ", pixelData);

          console.log("Full Volume (3D): %c not yet working", "color:red");

          console.log(
            "Voxel Access: ",
            imageData.getPointData().getArrays()[0].getValue(60000)
          );

          console.log("Single Slice Access: %c not yet working", "color:red");

          console.log(
            "2D or 3D Subvolume: ",
            imageData.getPointData().getArrays()[0].getTuples(1, 200)
          );



          // Get range from the flattened array of data
          // console.log("Range: ", imageData.getPointData().getArrays()[0].getTuples(2, 400));
        });

        
        

        // create color and opacity transfer functions
        const ctfun = vtk.Rendering.Core.vtkColorTransferFunction.newInstance();
        ctfun.addRGBPoint(200.0, 1.0, 1.0, 1.0);
        ctfun.addRGBPoint(2000.0, 0.0, 0.0, 0.0);
        const ofun = vtk.Common.DataModel.vtkPiecewiseFunction.newInstance();
        ofun.addPoint(200.0, 0.0);
        ofun.addPoint(1200.0, 0.2);
        ofun.addPoint(4000.0, 0.4);
        actor.getProperty().setRGBTransferFunction(0, ctfun);
        actor.getProperty().setScalarOpacity(0, ofun);
        actor.getProperty().setScalarOpacityUnitDistance(0, 4.5);
        // actor.getProperty().setInterpolationTypeToNearest();
        // actor.getProperty().setInterpolationTypeToFastLinear();
        actor.getProperty().setInterpolationTypeToLinear();

        renderer.addActor(actor);

    </script>
  </body>
</html>
